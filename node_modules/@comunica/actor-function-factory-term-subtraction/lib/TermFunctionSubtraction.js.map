{"version":3,"file":"TermFunctionSubtraction.js","sourceRoot":"","sources":["TermFunctionSubtraction.ts"],"names":[],"mappings":";;;AAAA,yEAAkE;AAClE,+DAAoE;AAEpE,qFAa8C;AAC9C,+CAAyC;AAEzC,MAAa,uBAAwB,SAAQ,uCAAgB;IAC3D;QACE,KAAK,CAAC;YACJ,KAAK,EAAE,CAAC;YACR,QAAQ,EAAE,2CAAc,CAAC,WAAW;YACpC,SAAS,EAAE,IAAA,oCAAO,EAAC,2CAAc,CAAC,WAAW,CAAC;iBAC3C,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,IAAI,wBAAS,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,CAAC;iBAC9E,GAAG,CAAC,CAAE,oCAAO,CAAC,aAAa,EAAE,oCAAO,CAAC,aAAa,CAAE,EAAE,QAAQ,CAAC,EAAE,CAChE,CAAC,CAAE,KAAK,EAAE,KAAK,CAAwC,EAAE,EAAE;YAC3D,kEAAkE;YAChE,IAAI,mDAAsB,CAAC,IAAA,4CAAe,EACxC,KAAK,CAAC,UAAU,EAChB,KAAK,CAAC,UAAU,EAChB,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,yCAAuB,CAAC,eAAe,CAAC,CAClE,CAAC,CAAC;iBACN,IAAI,CAAC,EAAE,IAAI,EAAE,CAAE,oCAAO,CAAC,aAAa,EAAE,oCAAO,CAAC,aAAa,CAAE,EAAE,EAAE,EAAE,CAAE,oCAAO,CAAC,QAAQ,EAAE,oCAAO,CAAC,QAAQ,CAAE,EAAC,CAAC;iBAC3G,IAAI,CAAC,EAAE,IAAI,EAAE,CAAE,oCAAO,CAAC,aAAa,EAAE,oCAAO,CAAC,aAAa,CAAE,EAAE,EAAE,EAAE,CAAE,oCAAO,CAAC,QAAQ,EAAE,oCAAO,CAAC,QAAQ,CAAE,EAAC,CAAC;iBAC3G,GAAG,CAAC,CAAE,oCAAO,CAAC,aAAa,EAAE,oCAAO,CAAC,qBAAqB,CAAE,EAAE,GAAG,EAAE,CAClE,CAAC,CAAE,IAAI,EAAE,GAAG,CAA+C,EAAE,EAAE;YAC/D,qFAAqF;YACnF,IAAI,4CAAe,CAAC,IAAA,kDAAqB,EACvC,IAAI,CAAC,UAAU,EACf,IAAA,4DAA+B,EAAC,IAAA,2CAAc,EAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAChE,CAAC,CAAC;iBACN,IAAI,CAAC;gBACJ,IAAI,EAAE,CAAE,oCAAO,CAAC,aAAa,EAAE,oCAAO,CAAC,qBAAqB,CAAE;gBAC9D,EAAE,EAAE,CAAE,oCAAO,CAAC,aAAa,EAAE,oCAAO,CAAC,uBAAuB,CAAE;aAC/D,CAAC;iBACD,GAAG,CAAC,CAAE,oCAAO,CAAC,QAAQ,EAAE,oCAAO,CAAC,qBAAqB,CAAE,EAAE,GAAG,EAAE,CAC7D,CAAC,CAAE,IAAI,EAAE,GAAG,CAA2C,EAAE,EAAE;YAC3D,iFAAiF;YAC/E,IAAI,wCAAW,CAAC,IAAA,kDAAqB,EACnC,IAAA,4DAA+B,EAAC,IAAI,CAAC,UAAU,CAAC,EAChD,IAAA,4DAA+B,EAAC,IAAA,2CAAc,EAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAChE,CAAC,CAAC;iBACN,IAAI,CAAC;gBACJ,IAAI,EAAE,CAAE,oCAAO,CAAC,QAAQ,EAAE,oCAAO,CAAC,qBAAqB,CAAE;gBACzD,EAAE,EAAE,CAAE,oCAAO,CAAC,QAAQ,EAAE,oCAAO,CAAC,uBAAuB,CAAE;aAC1D,CAAC;iBACD,GAAG,CAAC,CAAE,oCAAO,CAAC,QAAQ,EAAE,oCAAO,CAAC,qBAAqB,CAAE,EAAE,GAAG,EAAE,CAC7D,CAAC,CAAE,IAAI,EAAE,GAAG,CAA2C,EAAE,EAAE;YAC3D,iFAAiF;YAC/E,IAAI,wCAAW,CAAC,IAAA,kDAAqB,EACnC,IAAA,4DAA+B,EAAC,IAAI,CAAC,UAAU,CAAC,EAChD,IAAA,4DAA+B,EAAC,IAAA,2CAAc,EAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAChE,CAAC,CAAC;iBACN,OAAO,EAAE;SACb,CAAC,CAAC;IACL,CAAC;CACF;AAjDD,0DAiDC","sourcesContent":["import { TermFunctionBase } from '@comunica/bus-function-factory';\nimport { KeysExpressionEvaluator } from '@comunica/context-entries';\n\nimport {\n  addDurationToDateTime,\n  DateLiteral,\n  DateTimeLiteral,\n  DayTimeDurationLiteral,\n  declare,\n  defaultedDateTimeRepresentation,\n  defaultedDurationRepresentation,\n  elapsedDuration,\n  negateDuration,\n  SparqlOperator,\n  TimeLiteral,\n  TypeURL,\n} from '@comunica/utils-expression-evaluator';\nimport { BigNumber } from 'bignumber.js';\n\nexport class TermFunctionSubtraction extends TermFunctionBase {\n  public constructor() {\n    super({\n      arity: 2,\n      operator: SparqlOperator.SUBTRACTION,\n      overloads: declare(SparqlOperator.SUBTRACTION)\n        .arithmetic(() => (left, right) => new BigNumber(left).minus(right).toNumber())\n        .set([ TypeURL.XSD_DATE_TIME, TypeURL.XSD_DATE_TIME ], exprEval =>\n          ([ date1, date2 ]: [ DateTimeLiteral, DateTimeLiteral ]) =>\n          // https://www.w3.org/TR/xpath-functions/#func-subtract-dateTimes;\n            new DayTimeDurationLiteral(elapsedDuration(\n              date1.typedValue,\n              date2.typedValue,\n              exprEval.context.getSafe(KeysExpressionEvaluator.defaultTimeZone),\n            )))\n        .copy({ from: [ TypeURL.XSD_DATE_TIME, TypeURL.XSD_DATE_TIME ], to: [ TypeURL.XSD_DATE, TypeURL.XSD_DATE ]})\n        .copy({ from: [ TypeURL.XSD_DATE_TIME, TypeURL.XSD_DATE_TIME ], to: [ TypeURL.XSD_TIME, TypeURL.XSD_TIME ]})\n        .set([ TypeURL.XSD_DATE_TIME, TypeURL.XSD_DAY_TIME_DURATION ], () =>\n          ([ date, dur ]: [ DateTimeLiteral, DayTimeDurationLiteral ]) =>\n          // https://www.w3.org/TR/xpath-functions/#func-subtract-dayTimeDuration-from-dateTime\n            new DateTimeLiteral(addDurationToDateTime(\n              date.typedValue,\n              defaultedDurationRepresentation(negateDuration(dur.typedValue)),\n            )))\n        .copy({\n          from: [ TypeURL.XSD_DATE_TIME, TypeURL.XSD_DAY_TIME_DURATION ],\n          to: [ TypeURL.XSD_DATE_TIME, TypeURL.XSD_YEAR_MONTH_DURATION ],\n        })\n        .set([ TypeURL.XSD_DATE, TypeURL.XSD_DAY_TIME_DURATION ], () =>\n          ([ date, dur ]: [ DateLiteral, DayTimeDurationLiteral ]) =>\n          // https://www.w3.org/TR/xpath-functions/#func-subtract-dayTimeDuration-from-date\n            new DateLiteral(addDurationToDateTime(\n              defaultedDateTimeRepresentation(date.typedValue),\n              defaultedDurationRepresentation(negateDuration(dur.typedValue)),\n            )))\n        .copy({\n          from: [ TypeURL.XSD_DATE, TypeURL.XSD_DAY_TIME_DURATION ],\n          to: [ TypeURL.XSD_DATE, TypeURL.XSD_YEAR_MONTH_DURATION ],\n        })\n        .set([ TypeURL.XSD_TIME, TypeURL.XSD_DAY_TIME_DURATION ], () =>\n          ([ time, dur ]: [ TimeLiteral, DayTimeDurationLiteral ]) =>\n          // https://www.w3.org/TR/xpath-functions/#func-subtract-dayTimeDuration-from-date\n            new TimeLiteral(addDurationToDateTime(\n              defaultedDateTimeRepresentation(time.typedValue),\n              defaultedDurationRepresentation(negateDuration(dur.typedValue)),\n            )))\n        .collect(),\n    });\n  }\n}\n"]}